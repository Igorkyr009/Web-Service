<!doctype html>
<html lang="uk">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>–ú–∞–≥–∞–∑–∏–Ω</title>
  <style>
    body { font-family: system-ui, sans-serif; margin: 0 auto; padding: 16px; max-width: 900px; }
    header { display:flex; gap:12px; align-items:center; justify-content:space-between; }
    .grid { display:grid; grid-template-columns: repeat(auto-fill,minmax(220px,1fr)); gap:16px; margin-top:16px; }
    .card { border:1px solid #eee; border-radius:12px; padding:12px; box-shadow: 0 2px 8px rgba(0,0,0,.04); }
    .card img { width:100%; border-radius:8px; aspect-ratio: 3/2; object-fit:cover; background:#f5f5f5; }
    .card h4 { margin:8px 0 4px; }
    .row { display:flex; align-items:center; justify-content:space-between; gap:8px; }
    .muted { color:#666; font-size:12px; }
    button { padding:8px 10px; border-radius:8px; border:1px solid #ddd; background:#fff; cursor:pointer; }
    .primary { background:#0ea5e9; color:white; border-color:#0ea5e9; }
    .footer { position:sticky; bottom:0; background:white; padding:12px; border-top:1px solid #eee; display:flex; justify-content:space-between; align-items:center; }
  </style>
</head>
<body>
  <header>
    <h2>üõç –í—ñ—Ç—Ä–∏–Ω–∞</h2>
    <div>
      <button id="btnCart">üß∫ –ö–æ—Ä–∑–∏–Ω–∞ (<span id="cartCount">0</span>)</button>
      <button id="btnCheckout" class="primary">–û—Ñ–æ—Ä–º–∏—Ç–∏</button>
    </div>
  </header>

  <div id="catalog" class="grid"></div>

  <script>
    const API_BASE = "https://YOUR-RENDER-SERVICE.onrender.com"; // <-- –ø–æ–¥—Å—Ç–∞–≤—å —Å–≤–æ–π URL
    const cart = new Map(); // sku -> qty

    function priceFmt(p, c) { return `${p} ${c||'UAH'}`; }
    function renderCartCount() {
      let n = 0; for (const q of cart.values()) n += q;
      document.getElementById('cartCount').textContent = n;
    }
    function addToCart(sku) {
      cart.set(sku, (cart.get(sku)||0)+1);
      renderCartCount();
    }

    async function loadCatalog() {
      const r = await fetch(`${API_BASE}/api/catalog`);
      const data = await r.json();
      const root = document.getElementById('catalog');
      root.innerHTML = "";
      data.items.filter(x => x.is_active).forEach(p => {
        const el = document.createElement('div');
        el.className = 'card';
        el.innerHTML = `
          <img src="${p.image_url || 'https://via.placeholder.com/600x400?text=No+Image'}" alt="">
          <h4>${p.title}</h4>
          <div class="muted">${p.description||''}</div>
          <div class="row">
            <b>${priceFmt(p.price, p.currency)}</b>
            <button class="primary">–î–æ–¥–∞—Ç–∏</button>
          </div>
        `;
        el.querySelector('button').onclick = () => addToCart(p.sku);
        root.appendChild(el);
      });
    }

    // Telegram checkout
    function tgSendCheckout() {
      if (!window.Telegram || !window.Telegram.WebApp) {
        alert('–í—ñ–¥–∫—Ä–∏–π—Ç–µ —É Telegram');
        return;
      }
      if (cart.size === 0) {
        alert('–ö–æ—Ä–∑–∏–Ω–∞ –ø–æ—Ä–æ–∂–Ω—è'); return;
      }
      // –ø—Ä–æ—Å—Ç–∞—è —Ñ–æ—Ä–º–∞ (–º–æ–∂–Ω–æ —Å–¥–µ–ª–∞—Ç—å –∫—Ä–∞—Å–∏–≤–µ–µ)
      const city = prompt('–ú—ñ—Å—Ç–æ:') || '';
      const branch = prompt('–í—ñ–¥–¥—ñ–ª–µ–Ω–Ω—è –ù–ü:') || '';
      const receiver = prompt('–ü–Ü–ë:') || '';
      const phone = prompt('–¢–µ–ª–µ—Ñ–æ–Ω:') || '';

      const items = Array.from(cart.entries()).map(([sku, qty]) => ({sku, qty}));
      Telegram.WebApp.ready();
      Telegram.WebApp.sendData(JSON.stringify({
        type: 'checkout',
        items, city, branch, receiver, phone
      }));
      Telegram.WebApp.close();
    }

    document.getElementById('btnCheckout').onclick = tgSendCheckout;
    document.getElementById('btnCart').onclick = () => {
      alert([...cart.entries()].map(([s,q]) => `${s} x ${q}`).join('\n') || '–ü–æ—Ä–æ–∂–Ω—å–æ');
    };

    loadCatalog();
  </script>
</body>
</html>

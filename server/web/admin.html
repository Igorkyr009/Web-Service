<!doctype html>
<html lang="uk">
<meta charset="utf-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<title>Адмінка</title>
<style>
  body{font-family:system-ui,sans-serif;margin:0 auto;max-width:820px;padding:16px}
  input,textarea{width:100%;padding:10px;margin:6px 0 12px;border:1px solid #ddd;border-radius:8px}
  .row{display:grid;grid-template-columns:1fr 1fr;gap:12px}
  button{padding:10px 12px;border-radius:8px;border:1px solid #ddd;background:#0ea5e9;color:#fff;cursor:pointer}
  .muted{color:#666;font-size:12px}
  img#preview{max-height:80px;border-radius:8px;display:none}
</style>
<body>
  <h2>Адмін-панель</h2>
  <p class="muted">Введи секрет з Render (ENV <b>ADMIN_SECRET</b>). Він збережеться у браузері.</p>

  <label>Admin Secret</label>
  <input id="sec" placeholder="секрет">

  <hr>
  <h3>Створити / оновити товар</h3>

  <label>SKU</label>
  <input id="sku" placeholder="унікальний код (coffee_1kg)">

  <label>Назва</label>
  <input id="title" placeholder="Назва товару">

  <div class="row">
    <div>
      <label>Ціна</label>
      <input id="price" type="number" placeholder="1299">
    </div>
    <div>
      <label>Валюта</label>
      <input id="cur" value="UAH">
    </div>
  </div>

  <label>Категорія</label>
  <input id="cat" placeholder="Кофе / Мерч / ...">

  <!-- Блок загрузки фото -->
  <label>Фото</label>
  <input id="file" type="file" accept="image/*">
  <div style="display:flex;gap:12px;align-items:center;margin:6px 0 12px">
    <button id="btnUpload" type="button">Завантажити фото</button>
    <img id="preview">
  </div>
  <input id="image_url" placeholder="/uploads/....webp">

  <label>Опис</label>
  <textarea id="desc" rows="4" placeholder="Короткий опис"></textarea>

  <label><input type="checkbox" id="active" checked> Активний</label>
  <div style="margin-top:8px">
    <button id="save" type="button">Зберегти</button>
  </div>

<script>
  // секрет
  const sec = document.getElementById('sec');
  sec.value = localStorage.getItem('admin_secret') || '';
  sec.oninput = () => localStorage.setItem('admin_secret', sec.value);

  const $ = id => document.getElementById(id);

  // загрузка фото
  const fileInput = $('file');
  const btnUpload = $('btnUpload');
  const imgUrl    = $('image_url');
  const preview   = $('preview');

  btnUpload.addEventListener('click', async () => {
    const file = fileInput.files[0];
    if (!file) { alert('Оберіть файл'); return; }

    btnUpload.disabled = true;
    btnUpload.textContent = 'Завантаження...';

    try {
      const fd = new FormData();
      fd.append('file', file);
      const res = await fetch('/api/upload', { method: 'POST', body: fd });
      const data = await res.json();
      if (!res.ok) throw new Error(data.error || 'Upload error');

      imgUrl.value = data.url;     // /uploads/xxxx.webp
      preview.src = data.url;
      preview.style.display = '';
    } catch (e) {
      alert(e.message);
    } finally {
      btnUpload.disabled = false;
      btnUpload.textContent = 'Завантажити фото';
    }
  });

  // сохранение товара (UPSERT)
  $('save').onclick = async () => {
    const payload = {
      sku: $('sku').value.trim(),
      title: $('title').value.trim(),
      price: parseInt(($('price').value || '0'), 10),
      currency: ($('cur').value || 'UAH').trim(),
      category: $('cat').value.trim(),
      image_url: $('image_url').value.trim(),
      description: $('desc').value.trim(),
      is_active: $('active').checked
    };

    if (!sec.value || !payload.sku || !payload.title || !payload.price) {
      alert('Заповни SECRET, SKU, Назву і Ціну'); return;
    }

    try {
      const res = await fetch('/api/admin/products', {
        method: 'POST',
        headers: {'Content-Type':'application/json','X-Admin-Secret': sec.value},
        body: JSON.stringify(payload)
      });
      const txt = await res.text();
      if (!res.ok) throw new Error(txt);
      alert('✅ Збережено');
    } catch (e) {
      alert('Помилка: ' + e.message);
    }
  };
</script>
</body>
</html>


   











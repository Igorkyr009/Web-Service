<!doctype html><html lang="uk">
<meta charset="utf-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<title>Адмінка</title>
<style>
  *,*::before,*::after{box-sizing:border-box}
  body{font:14px/1.5 system-ui,-apple-system,Segoe UI,Roboto,Ubuntu,sans-serif;margin:0 auto;max-width:1000px;padding:16px;background:#fafafa;color:#0f172a}
  h2,h3{margin:0 0 10px}
  .wrap{display:grid;grid-template-columns:360px 1fr;gap:16px}
  @media (max-width:980px){ .wrap{grid-template-columns:1fr} }
  input,textarea,select{width:100%;padding:10px;border:1px solid #e5e7eb;border-radius:12px;background:#fff}
  button{padding:10px 12px;border:1px solid #e5e7eb;border-radius:12px;background:#fff;cursor:pointer}
  .primary{background:#0ea5e9;border-color:#0ea5e9;color:#fff}
  .muted{color:#64748b}
  .card{border:1px solid #e5e7eb;border-radius:14px;background:#fff;padding:12px}
  .list{display:grid;gap:8px;max-height:65vh;overflow:auto}
  .row{display:flex;align-items:center;justify-content:space-between;gap:8px}
  .item{padding:8px;border:1px solid #e5e7eb;border-radius:10px;cursor:pointer}
  .item:hover{background:#f8fafc}
  .preview{width:200px;aspect-ratio:1/1;object-fit:cover;border-radius:10px;background:#f3f4f6;border:1px solid #e5e7eb}
  .grid{display:grid;grid-template-columns:1fr 1fr;gap:12px}
  .full{grid-column:1/-1}
</style>
<body>
  <h2>Адмінка</h2>
  <div class="row" style="margin-bottom:10px">
    <div style="flex:1">
      <input id="admkey" placeholder="Admin Secret (X-Admin-Secret)">
    </div>
    <button id="saveKey">Зберегти ключ</button>
  </div>

  <div class="wrap">
    <div class="card">
      <div class="row" style="gap:8px;margin-bottom:8px">
        <input id="q" placeholder="Пошук за SKU/назвою">
        <button id="find">Знайти</button>
        <button id="new">Новий</button>
      </div>
      <div id="list" class="list"></div>
    </div>

    <div class="card">
      <h3>Товар</h3>
      <div class="grid">
        <div><label class="muted">SKU<input id="sku" placeholder="унікальний ключ"></label></div>
        <div><label class="muted">Активний
          <select id="is_active"><option value="1">Так</option><option value="0">Ні</option></select>
        </label></div>

        <div class="full"><label class="muted">Назва<input id="title" placeholder="Назва"></label></div>
        <div class="full"><label class="muted">Опис<textarea id="description" rows="4" placeholder="Короткий опис"></textarea></label></div>

        <div><label class="muted">Ціна<input id="price" type="number" min="0" placeholder="0"></label></div>
        <div><label class="muted">Валюта<input id="currency" value="UAH"></label></div>

        <div><label class="muted">Категорія
          <select id="category">
            <option value="">—</option>
            <option value="devices">Пристрої</option>
            <option value="liquids">Рідини</option>
            <option value="cartridges">Картриджі</option>
          </select>
        </label></div>

        <div><label class="muted">Наявність
          <select id="availability">
            <option value="in_stock">В наявності</option>
            <option value="preorder">Передзамовлення</option>
          </select>
        </label></div>

        <div class="full">
          <label class="muted">Зображення (URL)
            <input id="image_url" placeholder="/uploads/....jpg або https://...">
          </label>
        </div>

        <div>
          <img id="preview" class="preview" src="https://via.placeholder.com/800?text=No+Image" alt="">
        </div>
        <div>
          <label class="muted">Завантажити зображення (обрізає 800×800)
            <input id="file" type="file" accept="image/*">
          </label>
          <div class="muted" style="margin-top:6px">Після завантаження поле URL заповниться автоматично</div>
        </div>

        <div class="full" style="display:flex;gap:8px;justify-content:flex-end">
          <button id="save" class="primary">Зберегти</button>
        </div>
      </div>
    </div>
  </div>

<script>
const $=s=>document.querySelector(s);
const API = {
  products:(q)=>'/api/products'+(q?`?q=${encodeURIComponent(q)}`:''),
  put:(sku)=>`/api/products/${encodeURIComponent(sku)}`,
  upload:'/api/upload'
};

function key(){ return localStorage.getItem('adm.key')||''; }
function headers(){ const k=key(); return k?{'X-Admin-Secret':k}:{ }; }

async function list(q){
  const r = await fetch(API.products(q), {headers:headers()});
  if(!r.ok){ alert('Помилка авторизації (Admin Secret)'); return; }
  const j = await r.json();
  const items = j.items||[];
  $('#list').innerHTML = items.map(p=>`
    <div class="item" data-sku="${p.sku}">
      <div class="row">
        <b>${p.title}</b>
        <span class="muted">${p.sku}</span>
      </div>
      <div class="muted">${p.category||'—'} · ${p.availability==='preorder'?'предзамовлення':'в наявності'} · ${p.is_active?'активний':'—'}</div>
    </div>
  `).join('');
  [...document.querySelectorAll('.item')].forEach(el=>{
    el.onclick = ()=>{
      const sku = el.dataset.sku;
      const p = items.find(x=>x.sku===sku);
      fill(p);
    };
  });
}

function fill(p){
  $('#sku').value = p?.sku || '';
  $('#title').value = p?.title || '';
  $('#description').value = p?.description || '';
  $('#price').value = p?.price || 0;
  $('#currency').value = p?.currency || 'UAH';
  $('#image_url').value = p?.image_url || '';
  $('#is_active').value = (p?.is_active?1:0);
  $('#category').value = p?.category || '';
  $('#availability').value = p?.availability || 'in_stock';
  $('#preview').src = p?.image_url || 'https://via.placeholder.com/800?text=No+Image';
  $('#file').value = '';
}

async function save(){
  const sku=$('#sku').value.trim();
  if(!sku){ alert('Вкажіть SKU'); return; }

  // если выбран файл — сначала загрузим
  const file = $('#file').files[0];
  let image_url = $('#image_url').value.trim();
  if(file){
    const fd = new FormData();
    fd.append('file', file);
    const r = await fetch(API.upload, {method:'POST', headers:headers(), body:fd});
    if(!r.ok){ alert('Не вдалося завантажити зображення'); return; }
    const j = await r.json();
    if(j.ok && j.url){ image_url = j.url; $('#image_url').value = image_url; $('#preview').src = image_url; }
  }

  const body = {
    title: $('#title').value.trim(),
    description: $('#description').value.trim(),
    price: parseInt($('#price').value||0,10),
    currency: $('#currency').value.trim()||'UAH',
    image_url,
    is_active: parseInt($('#is_active').value||0,10),
    category: $('#category').value.trim(),
    availability: $('#availability').value.trim()||'in_stock'
  };

  const r = await fetch(API.put(sku), {method:'PUT', headers:{'Content-Type':'application/json', ...headers()}, body:JSON.stringify(body)});
  if(!r.ok){ alert('Помилка збереження'); return; }
  alert('Збережено');
  await list($('#q').value.trim());
}

document.addEventListener('DOMContentLoaded', async ()=>{
  const k = localStorage.getItem('adm.key')||'';
  $('#admkey').value = k;

  $('#saveKey').onclick = ()=>{ localStorage.setItem('adm.key', $('#admkey').value.trim()); alert('Ключ збережено'); };
  $('#find').onclick = ()=> list($('#q').value.trim());
  $('#new').onclick = ()=> fill({sku:'',title:'',description:'',price:0,currency:'UAH',image_url:'',is_active:true,category:'',availability:'in_stock'});
  $('#image_url').oninput = ()=>{ $('#preview').src = $('#image_url').value.trim() || 'https://via.placeholder.com/800?text=No+Image'; }
  $('#save').onclick = save;

  await list('');
});
</script>
</body>
</html>





   



















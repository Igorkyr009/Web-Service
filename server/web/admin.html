<!doctype html>
<html lang="uk">
<meta charset="utf-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<title>Адмінка</title>
<style>
  :root{--bg:#0ea5e9;--fg:#fff;--border:#e5e7eb;--muted:#667085}
  body{font-family:system-ui,Segoe UI,Roboto,sans-serif;margin:0 auto;max-width:1100px;padding:16px}
  h2{margin:0 0 10px}
  .row{display:flex;gap:12px;align-items:center;flex-wrap:wrap}
  input,select,textarea{padding:8px 10px;border:1px solid var(--border);border-radius:8px;min-width:0}
  textarea{width:100%;min-height:90px}
  button{padding:8px 12px;border-radius:10px;border:1px solid var(--border);background:#fff;cursor:pointer}
  .primary{background:var(--bg);color:var(--fg);border-color:var(--bg)}
  .grid{display:grid;grid-template-columns:320px 1fr;gap:16px}
  .card{border:1px solid var(--border);border-radius:14px;padding:12px;background:#fff}
  .table{width:100%;border-collapse:collapse}
  .table th,.table td{border-bottom:1px solid #eee;padding:8px;text-align:left}
  .muted{color:var(--muted);font-size:12px}
  .tabs{display:flex;gap:8px;margin-bottom:12px}
  .thumb{width:80px;height:80px;border-radius:10px;object-fit:cover;background:#f5f5f5}
</style>
<body>
  <h2>Адмінка</h2>
  <div class="row">
    <input id="secret" placeholder="Admin secret" style="flex:1">
    <button id="btnSaveSecret" class="primary">Зберегти</button>
    <span class="muted">Секрет зберігається у вашому браузері (localStorage).</span>
  </div>

  <div class="tabs">
    <button id="tabProducts" class="primary">Товари</button>
    <button id="tabOrders">Замовлення</button>
  </div>

  <div id="viewProducts">
    <div class="grid">
      <div class="card">
        <div class="row"><b>Редактор товару</b></div>
        <div class="row"><input id="sku" placeholder="SKU (унікальний)" style="flex:1"></div>
        <div class="row"><input id="title" placeholder="Назва" style="flex:1"></div>
        <div class="row">
          <input id="price" type="number" placeholder="Ціна" style="width:150px">
          <select id="currency">
            <option value="UAH" selected>UAH</option>
            <option>USD</option><option>EUR</option>
          </select>
          <select id="category">
            <option value="devices" selected>Девайси</option>
            <option value="liquids">Рідини</option>
            <option value="cartridges">Картриджі</option>
            <option value="other">Інше</option>
          </select>
          <select id="stock_status">
            <option value="in_stock" selected>В наявності</option>
            <option value="preorder">Предзамовлення</option>
          </select>
          <label><input type="checkbox" id="is_active" checked> Активний</label>
        </div>
        <div class="row"><input id="image_url" placeholder="Посилання на зображення" style="flex:1"></div>
        <div class="row">
          <input id="file" type="file" accept=".jpg,.jpeg,.png,.webp">
          <button id="btnUpload">Завантажити зображення</button>
        </div>
        <div class="row"><textarea id="description" placeholder="Опис"></textarea></div>
        <div class="row">
          <button id="btnSave" class="primary">Зберегти</button>
          <button id="btnNew">Очистити</button>
        </div>
      </div>

      <div class="card">
        <div class="row"><b>Каталог</b></div>
        <table class="table" id="tbl">
          <thead><tr><th>Прев’ю</th><th>Назва</th><th>SKU</th><th>Категорія</th><th>Ціна</th><th>Статус</th><th></th></tr></thead>
          <tbody></tbody>
        </table>
      </div>
    </div>
  </div>

  <div id="viewOrders" style="display:none">
    <div class="card">
      <div class="row"><b>Останні замовлення</b></div>
      <table class="table" id="tblOrders">
        <thead><tr><th>#</th><th>Клієнт</th><th>Контакти</th><th>Адреса</th><th>Склад</th><th>Разом</th></tr></thead>
        <tbody></tbody>
      </table>
    </div>
  </div>

<script>
const $ = s=>document.querySelector(s);
const fmt = (p,c)=>`${p} ${c||'UAH'}`;
function getSecret(){ return localStorage.getItem('admin_secret')||''; }
function setSecret(v){ localStorage.setItem('admin_secret', v||''); }

$("#secret").value = getSecret();
$("#btnSaveSecret").onclick = ()=>{ setSecret($("#secret").value.trim()); alert("Збережено"); };

$("#tabProducts").onclick = ()=>{
  $("#tabProducts").classList.add('primary'); $("#tabOrders").classList.remove('primary');
  $("#viewProducts").style.display='block'; $("#viewOrders").style.display='none';
  loadCatalog();
};
$("#tabOrders").onclick = async ()=>{
  $("#tabOrders").classList.add('primary'); $("#tabProducts").classList.remove('primary');
  $("#viewProducts").style.display='none'; $("#viewOrders").style.display='block';
  await loadOrders();
};

function clearForm(){
  $("#sku").value=""; $("#title").value=""; $("#price").value="";
  $("#currency").value="UAH"; $("#category").value="devices";
  $("#stock_status").value="in_stock"; $("#is_active").checked=true;
  $("#image_url").value=""; $("#description").value="";
}
$("#btnNew").onclick = clearForm;

async function loadCatalog(){
  const r = await fetch('/api/catalog');
  const data = await r.json();
  const tb = $("#tbl tbody"); tb.innerHTML = "";
  (data.items||[]).forEach(p=>{
    const tr = document.createElement('tr');
    tr.innerHTML = `
      <td><img class="thumb" src="${p.image_url||'https://picsum.photos/120'}"></td>
      <td>${p.title}<div class="muted">${p.description||''}</div></td>
      <td>${p.sku}</td>
      <td>${p.category||''}</td>
      <td>${fmt(p.price,p.currency)}</td>
      <td>${p.is_active? 'Активний':'Прихований'}${p.stock_status==='preorder'?' / Попереднє замовлення':''}</td>
      <td><button data-edit>Редагувати</button> <button data-del>Видалити</button></td>`;
    tr.querySelector('[data-edit]').onclick = ()=>{
      $("#sku").value = p.sku;
      $("#title").value = p.title;
      $("#price").value = p.price;
      $("#currency").value = p.currency||'UAH';
      $("#category").value = p.category||'devices';
      $("#stock_status").value = p.stock_status||'in_stock';
      $("#is_active").checked = !!p.is_active;
      $("#image_url").value = p.image_url||'';
      $("#description").value = p.description||'';
      window.scrollTo({top:0,behavior:'smooth'});
    };
    tr.querySelector('[data-del]').onclick = async ()=>{
      if(!confirm('Видалити товар?')) return;
      const r = await fetch('/api/product/'+encodeURIComponent(p.sku), {
        method:'DELETE',
        headers: {'X-Admin-Secret': getSecret()}
      });
      if(!r.ok){ alert('Помилка видалення'); return; }
      loadCatalog();
    };
    tb.appendChild(tr);
  });
}

$("#btnUpload").onclick = async ()=>{
  const f = $("#file").files[0];
  if(!f){ alert('Оберіть файл'); return; }
  const fd = new FormData();
  fd.append('file', f);
  const r = await fetch('/api/upload', { method:'POST', headers:{'X-Admin-Secret': getSecret()}, body: fd });
  if(!r.ok){ alert('Помилка завантаження'); return; }
  const data = await r.json();
  $("#image_url").value = data.url;
};

$("#btnSave").onclick = async ()=>{
  const body = {
    sku: $("#sku").value.trim(),
    title: $("#title").value.trim(),
    price: Number($("#price").value||0),
    currency: $("#currency").value,
    image_url: $("#image_url").value.trim(),
    description: $("#description").value.trim(),
    is_active: $("#is_active").checked ? 1 : 0,
    category: $("#category").value,
    stock_status: $("#stock_status").value
  };
  if(!body.sku || !body.title || !body.price){ alert('SKU, Назва, Ціна — обовʼязкові'); return; }
  const r = await fetch('/api/product', {
    method:'POST',
    headers: {'Content-Type':'application/json', 'X-Admin-Secret': getSecret()},
    body: JSON.stringify(body)
  });
  if(!r.ok){ alert('Помилка збереження'); return; }
  alert('Збережено'); loadCatalog();
};

async function loadOrders(){
  const r = await fetch('/api/orders', { headers: {'X-Admin-Secret': getSecret()} });
  if(!r.ok){ $("#tblOrders tbody").innerHTML = '<tr><td colspan="6">Помилка</td></tr>'; return; }
  const data = await r.json();
  const tb = $("#tblOrders tbody"); tb.innerHTML = "";
  (data.orders||[]).forEach(o=>{
    const who = (o.tg_username||'—') + "<br><span class='muted'>"+(o.tg_name||'')+"</span>";
    const contact = (o.receiver||'') + "<br><span class='muted'>"+(o.phone||'')+"</span>";
    const addr = (o.city||'—');
    const branch = (o.branch||'—');
    const total = fmt(o.total, o.currency);
    const tr = document.createElement('tr');
    tr.innerHTML = `<td>${o.id}</td><td>${who}</td><td>${contact}</td><td>${addr}</td><td>${branch}</td><td>${total}</td>`;
    tb.appendChild(tr);
  });
}

window.addEventListener('DOMContentLoaded', ()=>{ loadCatalog(); });
</script>
</body>
</html>








   






















<!doctype html><html lang="uk"><meta charset="utf-8">
<meta name="viewport" content="width=device-width,initial-scale=1"><title>–ú–∞–≥–∞–∑–∏–Ω</title>
<style>
 <script>
  function renderByHash(){
    const view = (location.hash || '#catalog').toLowerCase();
    if (view === '#checkout')  { showCheckout(); }
    else                       { showCatalog(); }
  }

  window.addEventListener('DOMContentLoaded', () => {
    // –µ—Å–ª–∏ —Ä–∞–Ω—å—à–µ —Å–æ—Ö—Ä–∞–Ω—è–ª —à–∞–≥ ‚Äî –º–æ–∂–Ω–æ —Å–±—Ä–æ—Å–∏—Ç—å, —á—Ç–æ–±—ã –Ω–µ –∑–∞–ª–∏–ø–∞–ª–æ:
    try { sessionStorage.removeItem('ui_step'); } catch(e){}
    renderByHash();
  });

  window.addEventListener('hashchange', renderByHash);
</script>
<script>
  // –∫–Ω–æ–ø–∫–∞ ¬´–û—Ñ–æ—Ä–º–∏—Ç–∏¬ª
  document.getElementById('btn-checkout').addEventListener('click', (e) => {
    e.preventDefault();
    // –µ—Å–ª–∏ –∫–æ—Ä–∑–∏–Ω–∞ –ø—É—Å—Ç–∞—è ‚Äî –ø–æ–¥—Å–∫–∞–∑–∫–∞ (–∑–∞–º–µ–Ω–∏ cart –Ω–∞ —Å–≤–æ—é –ø–µ—Ä–µ–º–µ–Ω–Ω—É—é):
    if (!window.cart || !cart.items || !cart.items.length) {
      alert('–ö–æ—Ä–∑–∏–Ω–∞ –ø–æ—Ä–æ–∂–Ω—è');
      return;
    }
    location.hash = 'checkout';   // –ø–µ—Ä–µ–∫–ª—é—á–∞–µ–º—Å—è –Ω–∞ —Å—Ç—Ä–∞–Ω–∏—Ü—É –æ—Ñ–æ—Ä–º–ª–µ–Ω–∏—è
  });

  // (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ) –∫–Ω–æ–ø–∫–∞ ¬´–ö–æ—à–∏–∫¬ª ‚Äî –Ω–∞ –∫–∞—Ç–∞–ª–æ–≥:
  // document.getElementById('btn-cart').addEventListener('click', () => {
  //   location.hash = 'catalog';
  // });
</script>

 body{font-family:system-ui,sans-serif;margin:0 auto;max-width:900px;padding:16px}
 header{display:flex;justify-content:space-between;align-items:center}
 .grid{display:grid;grid-template-columns:repeat(auto-fill,minmax(220px,1fr));gap:16px;margin-top:16px}
 .card{border:1px solid #eee;border-radius:12px;padding:12px}
 .card img{width:100%;border-radius:8px;aspect-ratio:3/2;object-fit:cover;background:#f5f5f5}
 .row{display:flex;justify-content:space-between;align-items:center}
 button{padding:8px 10px;border-radius:8px;border:1px solid #ddd;background:#fff;cursor:pointer}
 .primary{background:#0ea5e9;color:#fff;border-color:#0ea5e9}
 .muted{color:#666;font-size:12px;min-height:36px}
</style>
<body>
 <script>
  function wantsCheckout() {
    const q = new URLSearchParams(location.search);
    return location.hash === '#checkout' || (q.get('view')||'').toLowerCase()==='checkout';
  }
  window.addEventListener('DOMContentLoaded', () => {
    // –µ—Å–ª–∏ —Ç—ã —Å–æ—Ö—Ä–∞–Ω—è–ª —à–∞–≥ –≤ storage ‚Äî —Å–±—Ä–æ—Å—å, —á—Ç–æ–±—ã –Ω–µ –∑–∞–ª–∏–ø–∞–ª–æ –Ω–∞ —Å—Ç–∞—Ä–æ–º —ç–∫—Ä–∞–Ω–µ:
    try { sessionStorage.removeItem('ui_step'); } catch(e){}
    if (typeof showCheckout==='function' && typeof showCatalog==='function') {
      wantsCheckout() ? showCheckout() : showCatalog();
    }
  });
</script>

<header>
  <h2>üõç –í—ñ—Ç—Ä–∏–Ω–∞</h2>
  <div>
    <button id="btnCart">üß∫ –ö–æ—Ä–∑–∏–Ω–∞ (<span id="c">0</span>)</button>
    <button id="btnBuy" class="primary">–û—Ñ–æ—Ä–º–∏—Ç–∏</button>
   <button id="btn-checkout" class="btn">–û—Ñ–æ—Ä–º–∏—Ç–∏</button>

  </div>
</header>
<div id="root" class="grid"></div>
<script>
 const cart=new Map(); const fmt=(p,c)=>`${p} ${c||'UAH'}`;
 const renderCount=()=>{let n=0; for(const q of cart.values()) n+=q; document.getElementById('c').textContent=n};
 async function load(){
   const r=await fetch('/api/catalog'); const data=await r.json();
   const root=document.getElementById('root'); root.innerHTML='';
   data.items.filter(x=>x.is_active).forEach(p=>{
     const el=document.createElement('div'); el.className='card';
     el.innerHTML=`
       <img src="${p.image_url||'https://via.placeholder.com/600x400?text=No+Image'}">
       <h4>${p.title}</h4>
       <div class="muted">${p.description||''}</div>
       <div class="row"><b>${fmt(p.price,p.currency)}</b><button class="primary">–î–æ–¥–∞—Ç–∏</button></div>`;
     el.querySelector('button').onclick=()=>{cart.set(p.sku,(cart.get(p.sku)||0)+1);renderCount()};
     root.appendChild(el);
   });
 }
 function checkout(){
   if(!(window.Telegram&&window.Telegram.WebApp)){alert('–í—ñ–¥–∫—Ä–∏–π —Ü—é —Å—Ç–æ—Ä—ñ–Ω–∫—É –∑ Telegram');return}
   if(cart.size===0){alert('–ü–æ—Ä–æ–∂–Ω—è –∫–æ—Ä–∑–∏–Ω–∞');return}
   const city=prompt('–ú—ñ—Å—Ç–æ:')||'',branch=prompt('–í—ñ–¥–¥—ñ–ª–µ–Ω–Ω—è –ù–ü:')||'';
   const receiver=prompt('–ü–Ü–ë:')||'',phone=prompt('–¢–µ–ª–µ—Ñ–æ–Ω:')||'';
   const items=[...cart.entries()].map(([sku,qty])=>({sku,qty}));
   Telegram.WebApp.ready();
   Telegram.WebApp.sendData(JSON.stringify({type:'checkout',items,city,branch,receiver,phone}));
   Telegram.WebApp.close();
 }
 document.getElementById('btnBuy').onclick=checkout;
 document.getElementById('btnCart').onclick=()=>alert([...cart.entries()].map(([s,q])=>`${s} √ó ${q}`).join('\n')||'–ü–æ—Ä–æ–∂–Ω—å–æ');
 load();
</script>
</body></html>




